name: Merge Develop to Main

on:
  workflow_dispatch:
    inputs:
      trigger:
        description: '–¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞'
        required: true
        default: 'manual'
        type: string

jobs:
  merge:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Configure Git
      run: |
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git config --global user.name "github-actions[bot]"
    
    - name: Merge develop into main
      run: |
        git fetch origin
        git checkout main
        git merge develop --no-ff -m "Merge develop into main"
        git push origin main
    
    - name: Notify Telegram
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TG_CHAT }}
        token: ${{ secrets.TG_KEY }}
        message: |
          üîÑ –ó–∞–ø—É—â–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ä–µ–ª–∏–∑–∞
          
          –í–µ—Ç–∫–∞ develop —É—Å–ø–µ—à–Ω–æ —Å–º–µ—Ä–∂–µ–Ω–∞ –≤ main
          
          –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–º–º–∏—Ç: ${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}
          
          –û–∂–∏–¥–∞–π—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏ —Ä–µ–ª–∏–∑–∞... 

    - name: Notify Error to Telegram
      if: failure()
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TG_CHAT }}
        token: ${{ secrets.TG_KEY }}
        message: |
          ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–ª–∏–∑–∞
          
          –ù–µ —É–¥–∞–ª–æ—Å—å —Å–º–µ—Ä–∂–∏—Ç—å –≤–µ—Ç–∫—É develop –≤ main
          
          –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–º–º–∏—Ç: ${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}
          
          –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∏ –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫—É. 